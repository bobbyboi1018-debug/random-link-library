<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Link Library with Collections + Firebase</title>
  <style>
    body { font-family: Arial, sans-serif; background:#fafafa; margin:0; padding:0; }
    .navbar { display:flex; gap:20px; padding:10px; background:#222; color:#fff; }
    .tab { cursor:pointer; }
    .card-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:15px; padding:15px; }
    .card { background:white; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); padding:10px; text-align:center; }
    .card img { width:100%; height:120px; object-fit:cover; border-radius:8px; }
    button { margin:5px; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; }
    #auth-section { padding:20px; text-align:center; }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="tab" onclick="showTab('library')">ðŸ“š Library</div>
    <div class="tab" onclick="showTab('collections')">ðŸ—‚ Collections</div>
    <div class="tab" onclick="showTab('auth')">ðŸ”‘ Account</div>
    <button onclick="pickRandom()">ðŸŽ² Random</button>
    <button onclick="logout()">ðŸšª Logout</button>
  </div>

  <!-- Tabs -->
  <div id="library" class="tab-content"></div>
  <div id="collections" class="tab-content" style="display:none"></div>
  <div id="auth" class="tab-content" style="display:none">
    <div id="auth-section">
      <h2>Login / Signup</h2>
      <input type="email" id="email" placeholder="Email"><br><br>
      <input type="password" id="password" placeholder="Password"><br><br>
      <button onclick="signup()">Sign Up</button>
      <button onclick="login()">Login</button>
    </div>
  </div>

  <div id="player" style="padding:20px; text-align:center;"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¹ 1. Firebase Config (replace with your projectâ€™s config!)
    const firebaseConfig = {
      apiKey: "AIzaSyDRc16anNNe3Wvk1v8ndjPYat2J3wt9vtw",
      authDomain: "random-link-player.firebaseapp.com" ,
      projectId: "random-link-player",
      storageBucket: "random-link-player.firebasestorage.app",
      messagingSenderId: "155907012145",
      appId: "1:155907012145:web:32e3f3d543245834370710",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ðŸ”¹ 2. Global State
    let currentUser = null;
    let links = [];
    let collections = {};

    // ðŸ”¹ 3. Auth
    function signup() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("Account created!"))
        .catch(err => alert(err.message));
    }

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut();
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loadData();
      } else {
        currentUser = null;
        links = [];
        collections = {};
        renderLibrary();
        renderCollections();
      }
    });

    // ðŸ”¹ 4. Firestore Save & Load
    async function saveData() {
      if (!currentUser) return;
      await db.collection("users").doc(currentUser.uid).set({
        links, collections
      });
    }

    async function loadData() {
      if (!currentUser) return;
      const doc = await db.collection("users").doc(currentUser.uid).get();
      if (doc.exists) {
        links = doc.data().links || [];
        collections = doc.data().collections || {};
      }
      renderLibrary();
      renderCollections();
    }

    // ðŸ”¹ 5. Library
    function renderLibrary() {
      const div = document.getElementById("library");
      div.innerHTML = `<h2>Library</h2>
        <input type="text" id="newLink" placeholder="Enter link">
        <button onclick="addLink()">Add</button>
        <div class="card-grid"></div>`;
      const grid = div.querySelector(".card-grid");
      links.forEach((link, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${link.thumbnail || 'https://via.placeholder.com/200'}">
          <button onclick="playLink('${link.url}')">â–¶ Play</button>
          <a href="${link.url}" target="_blank"><button>ðŸ”— Link</button></a>
          <button onclick="deleteLink(${i})">ðŸ—‘ Delete</button>
        `;
        grid.appendChild(card);
      });
    }

    function addLink() {
      const url = document.getElementById("newLink").value;
      if (!url) return;
      links.push({ url });
      saveData();
      renderLibrary();
    }

    function deleteLink(i) {
      links.splice(i,1);
      saveData();
      renderLibrary();
    }

    // ðŸ”¹ 6. Collections
    function renderCollections() {
      const div = document.getElementById("collections");
      div.innerHTML = `<h2>Collections</h2>
        <input type="text" id="newCol" placeholder="New collection name">
        <button onclick="addCollection()">Add</button>
        <div id="colList"></div>`;
      const colList = div.querySelector("#colList");
      Object.keys(collections).forEach(name => {
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.onclick = () => showCollection(name);
        colList.appendChild(btn);
      });
    }

    function addCollection() {
      const name = document.getElementById("newCol").value;
      if (!name) return;
      collections[name] = collections[name] || [];
      saveData();
      renderCollections();
    }

    function showCollection(name) {
      const colDiv = document.getElementById("collections");
      colDiv.innerHTML = `<h3>${name}</h3>
        <button onclick="pickRandomFromCollection('${name}')">ðŸŽ² Pick Random</button>
        <div id="collectionCards" class="card-grid"></div>`;
      const grid = document.getElementById("collectionCards");
      collections[name].forEach((link, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${link.thumbnail || 'https://via.placeholder.com/200'}">
          <button onclick="playLink('${link.url}')">â–¶ Play</button>
          <a href="${link.url}" target="_blank"><button>ðŸ”— Link</button></a>
          <button onclick="deleteFromCollection('${name}',${i})">ðŸ—‘ Delete</button>
        `;
        grid.appendChild(card);
      });
    }

    function deleteFromCollection(name, i) {
      collections[name].splice(i,1);
      saveData();
      showCollection(name);
    }

    function pickRandomFromCollection(name) {
      const col = collections[name];
      if (!col || col.length === 0) { alert("Empty collection"); return; }
      const randomLink = col[Math.floor(Math.random()*col.length)];
      playLink(randomLink.url);
    }

    // ðŸ”¹ 7. Random & Player
    function pickRandom() {
      if (links.length === 0) { alert("No links!"); return; }
      const randomLink = links[Math.floor(Math.random()*links.length)];
      playLink(randomLink.url);
    }

    function playLink(url) {
      document.getElementById("player").innerHTML =
        `<iframe src="${url}" width="640" height="360" allowfullscreen></iframe>`;
    }

    // ðŸ”¹ 8. Tab System
    function showTab(tab) {
      document.querySelectorAll(".tab-content").forEach(el => el.style.display="none");
      document.getElementById(tab).style.display="block";
    }
  </script>
</body>
</html>

